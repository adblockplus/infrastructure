#!/bin/bash

if [[ $# != 2 ]]; then
    echo "Usage: `basename $0` WARN CRIT"
    exit 0
fi

warn=$1
crit=$2

i=$(vnstat -tr)

rx_line=$(echo $i | grep -o "rx [[:digit:]]*\.[[:digit:]]* kbit/s")
tx_line=$(echo $i | grep -o "tx [[:digit:]]*\.[[:digit:]]* kbit/s")

status="$rx_line $tx_line"

rx=$(echo $rx_line | awk '{ print $2 }' | awk -F\. '{ print $1 }')
tx=$(echo $tx_line | awk '{ print $2 }' | awk -F\. '{ print $1 }')

perfdata="rx=${rx};${warn};${crit} tx=${tx};${warn};${crit}"

if (( warn <= rx )) || (( warn <= tx )); then
  echo "WARNING - $status|$perfdata"
  exit 1
fi

if (( crit <= rx )) || (( crit <= tx )); then
  echo "CRITICAL - $status|$perfdata"
  exit 2
fi

echo "OK - $status|$perfdata"
